"0","# compute quartiles"
"0","quantiles <- customer_quarter %>% "
"0","  group_by(quarter) %>% "
"0","     summarise(q1 = quantile(tot_spend,0.25),"
"0","               q2 = quantile(tot_spend,0.5),"
"0","               q3 = quantile(tot_spend,0.75))"
"2","`summarise()` ungrouping output (override with `.groups` argument)
"
"0","# assign score to each customer"
"0","# in this loop scores are assigned to each customer for each quarter"
"0","s <- c()"
"0","k <- c()"
"0","q <- c()"
"0","score <- s"
"0","key <- k"
"0","quarter <- q"
"0",""
"0","for(j in seq(1:6)){"
"0","  ll <- customer_quarter %>% filter(quarter == j)"
"0","  qq <- quantiles %>% filter(quarter == j)"
"0","  "
"0","for(i in 1:nrow(ll)){"
"0","  k[i] <- ll$household_key[i]"
"0","  q[i] <- j"
"0","  if(ll$tot_spend[i] <= qq[2]){"
"0","    s[i] <- 1"
"0","    }else if(ll$tot_spend[i] > qq[2] & ll$tot_spend[i] <= qq[3]){"
"0","      s[i] <- 2"
"0","        }else if(ll$tot_spend[i] > qq[3] & ll$tot_spend[i] <= qq[4]){"
"0","        s[i] <- 3}"
"0","      else if(ll$tot_spend[i] > qq[4]) {s[i] <- 4}"
"0","}"
"0","  "
"0","quarter <- c(quarter,q)"
"0","score <- c(score,s)"
"0","key <- c(key,k)"
"0","}"
"0",""
"0","# obtain the scores given to the customers over the different quarters"
"0","quarter_scores <- data.frame(household_key = key, score,  quarter)"
"0",""
"0","# bind scores to the customers spend"
"0","customer_quarter <- customer_quarter %>% "
"0","  left_join(quarter_scores, by = c(""household_key"" = ""household_key"", ""quarter"" = ""quarter"")) %>% "
"0","  dplyr::select(-c(""tot_spend"")) %>% data.frame()"
"0",""
"0",""
